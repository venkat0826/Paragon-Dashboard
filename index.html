<!DOCTYPE html>
<html>
<head>
    <title>RP SA Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --amazon-purple: #f0f1ff;
            --amazon-dark: #232f3e;
            --amazon-orange: #ff9900;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: url('background.png') no-repeat center top;
            background-size: contain;
            background-color: #f5f5f5;
        }

        .header {
            background-color: rgba(240, 241, 255, 0.9);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .dashboard {
            max-width: 1400px;
            margin: 20px auto;
            padding: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .metric-box {
            background: var(--amazon-dark);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .metric-box h3 {
            margin: 0;
            font-size: 1.1em;
        }

        .metric-box p {
            margin: 10px 0 0;
            font-size: 1.5em;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }

        .form-group input, 
        .form-group select {
            padding: 8px;
            width: 250px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .button {
            background-color: var(--amazon-orange);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .button:hover {
            background-color: #e88a00;
        }

        .button.delete {
            background-color: #dc3545;
        }

        .button.delete:hover {
            background-color: #c82333;
        }

        .chart-container {
            height: 300px;
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }

        .data-management {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: var(--amazon-dark);
            color: white;
        }

        .column-filter {
            display: block;
            margin-top: 5px;
            padding: 2px;
            font-size: 12px;
            border: 1px solid #ddd;
            border-radius: 3px;
            background: white;
            width: 100%;
        }
.dashboard {
    max-width: 1400px;
    margin: 20px auto;
    padding: 20px;
}

.main-content {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}

.card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    flex: 1;
}

.chart-container {
    height: 300px;
    margin-bottom: 20px;
}
.fa-sync-alt {
    transition: transform 0.5s ease;
}

.rotating {
    transform: rotate(360deg);
}


    </style>
</head>
<body>
    <div class="header">
        <div class="logo-container">
            <div class="logo-item">
                <i class="fab fa-amazon fa-2a-2x"></i>
                <span>Amazon</span>
            </div>
            <div class="logo-item">
                <i class="fas fa-box fa-2x"></i>
                <span>RP</span>
            </div>
            <div class="logo-item">
                <i class="fas fa-shield-alt fa-2x"></i>
                <span>SA</span>
            </div>
        </div>
        <div class="header-section">
		<button class="button" onclick="refreshDashboard()" style="margin-right: 10px;">
       		 <i class="fas fa-sync-alt"></i> Refresh
  		  </button>
            <button class="button" onclick="exportCaseHistory()" style="margin-right: 10px;">
                <i class="fas fa-download"></i> Export Case History
            </button>
            <button class="button delete" onclick="clearData()">
                <i class="fas fa-trash"></i> Clear All Data
            </button>
        </div>
    </div>


   <div class="dashboard">
    <div class="main-content">
        <!-- Case Information -->
        <div class="card">
            <h2>Case Information</h2>
            <form id="caseForm">
                <div class="form-group">
                    <label>Case ID:</label>
                    <input type="text" id="caseId" required>
                </div>
                <div class="form-group">
                    <label>Case Type:</label>
                    <select id="caseType" required>
                        <option value="">Select Case Type</option>
                        <option value="Core">Core</option>
                        <option value="SME">SME</option>
                        <option value="SEP">SEP</option>
                        <option value="Intimate">Intimate</option>
                        <option value="Bulk">Bulk</option>
                        <option value="GRU">GRU</option>
                        <option value="Photon">Photon</option>
                        <option value="Intimate SME">Intimate SME</option>
                        <option value="Vendor Appeal">Vendor Appeal</option>
                        <option value="GP Appeal">GP Appeal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Reason Code:</label>
                    <select id="reasonCode" required>
                        <option value="">Select Reason</option>
                        <option value="PAA">PAA</option>
                        <option value="PMA">PMA</option>
                        <option value="No Path">No Path</option>
                        <option value="Reinstate">Reinstate</option>
                        <option value="Live">Live</option>
                        <option value="Acknowledgement">Acknowledgement</option>
                        <option value="Transfer">Transfer</option>
                        <option value="Initial Validation">Initial Validation</option>
                        <option value="ASIN Review">ASIN Review</option>
                        <option value="Blurbing">Blurbing</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Status:</label>
                    <select id="status" required>
                        <option value="Work-in-Progress">Work-in-Progress</option>
                        <option value="Resolved">Resolved</option>
                        <option value="Pending Amazon Action">Pending Amazon Action</option>
                        <option value="Pending Merchant Action">Pending Merchant Action</option>
                    </select>
                </div>
                <button type="submit" class="button">Add Case</button>
            </form>

            <div class="metrics-grid">
                <div class="metric-box">
                    <h3>Today Count</h3>
                    <p id="todayCaseCount">0</p>
                </div>
                <div class="metric-box">
                    <h3>Monthly Cases</h3>
                    <p id="monthlyCaseCount">0</p>
                </div>
                <div class="metric-box">
                    <h3>Today's AHT Used</h3>
                    <p id="todayAHT">0/480 mins</p>
                </div>
                <div class="metric-box">
                    <h3>Monthly AHT</h3>
                    <p id="monthlyAHT">0 mins</p>
                </div>
            </div>
        </div>

        <!-- Case Analytics -->
        <div class="card">
            <h2>Case Analytics</h2>
            <div class="chart-container">
                <h3>Daily Case Distribution</h3>
                <canvas id="caseChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Daily AHT Tracking</h3>
                <canvas id="ahtChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Rest of your dashboard content -->
</div>


        <div class="card">
            <h2>Data Management</h2>
            <div class="data-management">
                
                <input type="file" id="fileUpload" accept=".xlsx,.xls,.csv" />
                <button class="button" onclick="handleFileUpload()">
                    <i class="fas fa-upload"></i> Import Cases
<button class="button" onclick="downloadFilteredCases()">
                    <i class="fas fa-download"></i> Download Filtered Cases
                </button>
                </button>
            </div>
        </div>

        <div class="card">
            <h2>Case History</h2>
            <table id="caseTable">
                <thead>
                    <tr>
                        <th>Case ID</th>
                        <th>
                            Case Type
                            <select class="column-filter" id="caseTypeColumnFilter" onchange="filterColumn('caseType', this.value)">
                                <option value="">All</option>
                            </select>
                        </th>
                        <th>
                            Reason Code
                            <select class="column-filter" id="reasonCodeColumnFilter" onchange="filterColumn('reasonCode', this.value)">
                                <option value="">All</option>
                            </select>
                        </th>
                        <th>
                            Status
                            <select class="column-filter" id="statusColumnFilter" onchange="filterColumn('status', this.value)">
                                <option value="">All</option>
                            </select>
                        </th>
                        <th>
                            Created Date
                            <select class="column-filter" id="dateColumnFilter" onchange="filterColumn('createdDate', this.value)">
                                <option value="">All</option>
                            </select>
                        </th>
                        <th>AHT (min)</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
<script>
    // Global variables
    let cases = [];
    let caseChart = null;
    let ahtChart = null;

    // AHT configuration
    const queueAHT = {
        'Core': { regular: 7, sme: 8, consult: 12 },
        'SME': { regular: 7, sme: 8 },
        'SEP': { regular: 7, sme: 8 },
        'Intimate': { regular: 7, sme: 8 },
        'Intimate SME': { regular: 8 },
        'Bulk': { regular: 5 },
        'GRU': { regular: 12 },
        'Vendor Appeal': { regular: 7, sme: 8 },
        'GP Appeal': { regular: 7 }
    };

    // Format date
    function formatDate(date) {
        if (!date) return '';

        // Handle Excel serial number
        if (typeof date === 'number') {
            const excelEpoch = new Date(1899, 11, 30);
            const millisecondsPerDay = 24 * 60 * 60 * 1000;
            const dateObj = new Date(excelEpoch.getTime() + (date * millisecondsPerDay));
            
            const month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
            const day = dateObj.getDate().toString().padStart(2, '0');
            const year = dateObj.getFullYear().toString().slice(-2);
            
            return `${month}/${day}/${year}`;
        }

        // If it's already in MM/DD/YY format, return as is
        if (typeof date === 'string' && date.match(/^\d{1,2}\/\d{1,2}\/\d{2}$/)) {
            return date;
        }

        const d = new Date(date);
        const month = (d.getMonth() + 1).toString().padStart(2, '0');
        const day = d.getDate().toString().padStart(2, '0');
        const year = d.getFullYear().toString().slice(-2);
        
        return `${month}/${day}/${year}`;
    }

    // Calculate AHT
    function calculateAHT(caseType, reasonCode) {
        if (reasonCode === 'Transfer') {
            return 1.5;
        }
        
        if (reasonCode === 'Acknowledgement') {
            return caseType === 'Bulk' ? 0.3 : 2;
        }
        
        const queueConfig = queueAHT[caseType];
        if (!queueConfig) return 7;
        
        if (caseType.includes('SME') && queueConfig.sme) {
            return queueConfig.sme;
        }
        
        return queueConfig.regular;
    }

    // Initialize charts
    function initializeCharts() {
        // Case Distribution Chart
        const caseCtx = document.getElementById('caseChart');
        if (caseCtx) {
            if (caseChart) {
                caseChart.destroy();
            }

            const dailyCounts = {};
            cases.forEach(caseData => {
                const date = caseData.createdDate;
                dailyCounts[date] = (dailyCounts[date] || 0) + 1;
            });

            const dates = Object.keys(dailyCounts).sort();
            const counts = dates.map(date => dailyCounts[date]);

            caseChart = new Chart(caseCtx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Daily Case Count',
                        data: counts,
                        backgroundColor: '#ff9900',
                        borderColor: '#232f3e',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Cases'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        }
                    }
                }
            });
        }

        // AHT Chart
        const ahtCtx = document.getElementById('ahtChart');
        if (ahtCtx) {
            if (ahtChart) {
                ahtChart.destroy();
            }

            const dailyAHT = {};
            cases.forEach(caseData => {
                const date = caseData.createdDate;
                dailyAHT[date] = (dailyAHT[date] || 0) + caseData.aht;
            });

            const dates = Object.keys(dailyAHT).sort();
            const ahtValues = dates.map(date => dailyAHT[date]);

            ahtChart = new Chart(ahtCtx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Daily AHT Used',
                        data: ahtValues,
                        backgroundColor: '#ff9900',
                        borderColor: '#232f3e',
                        borderWidth: 1
                    }, {
                        label: 'Target AHT',
                        data: dates.map(() => 480),
                        type: 'line',
                        borderColor: '#dc3545',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Minutes'
                            }
                        }
                    }
                }
            });
        }
    }

    // Update metrics
    function updateMetrics() {
        const today = formatDate(new Date());
        const currentMonth = today.slice(0, 2);

        const todayCases = cases.filter(c => c.createdDate === today);
        document.getElementById('todayCaseCount').textContent = todayCases.length;

        const monthlyCases = cases.filter(c => c.createdDate.startsWith(currentMonth));
        document.getElementById('monthlyCaseCount').textContent = monthlyCases.length;

        const todayTotalAHT = todayCases.reduce((sum, c) => sum + c.aht, 0);
        const remainingAHT = 480 - todayTotalAHT;
        document.getElementById('todayAHT').textContent = `${todayTotalAHT}/480 mins`;
        
        if (remainingAHT > 0) {
            alert(`You still have ${remainingAHT} minutes of AHT remaining for today`);
        }

        const monthlyTotalAHT = monthlyCases.reduce((sum, c) => sum + c.aht, 0);
        document.getElementById('monthlyAHT').textContent = `${monthlyTotalAHT} mins`;
    }

    // Handle form submission
    document.getElementById('caseForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const caseData = {
            caseId: document.getElementById('caseId').value,
            caseType: document.getElementById('caseType').value,
            reasonCode: document.getElementById('reasonCode').value,
            status: document.getElementById('status').value,
            createdDate: formatDate(new Date()),
            aht: calculateAHT(
                document.getElementById('caseType').value,
                document.getElementById('reasonCode').value
            )
        };

        cases.push(caseData);
        updateDashboard();
        this.reset();
    });

    // Handle file upload
    function handleFileUpload() {
        const file = document.getElementById('fileUpload').files[0];
        if (!file) {
            alert('Please select a file first!');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const sheet = workbook.Sheets['Sheet1'];
                const jsonData = XLSX.utils.sheet_to_json(sheet);
                
                cases = [];

                jsonData.forEach(row => {
                    const caseData = {
                        caseId: row['Case ID'].toString(),
                        caseType: row['Case Type'],
                        reasonCode: row['Reason Code'],
                        status: row['Status'],
                        createdDate: formatDate(row['Created Date']),
                        aht: calculateAHT(row['Case Type'], row['Reason Code'])
                    };
                    cases.push(caseData);
                });

                updateDashboard();
                alert(`Successfully imported ${cases.length} cases`);
            } catch (error) {
                console.error('Error details:', error);
                alert('Error processing file: ' + error.message);
            }
        };
        reader.readAsArrayBuffer(file);
    }

    // Download filtered cases
    function downloadFilteredCases() {
        const filteredCases = getFilteredCases();
        const workbook = XLSX.utils.book_new();
        const worksheet = XLSX.utils.json_to_sheet(filteredCases);
        XLSX.utils.book_append_sheet(workbook, worksheet, 'Filtered Cases');
        XLSX.writeFile(workbook, 'filtered_cases.xlsx');
    }

    // Get filtered cases
    function getFilteredCases() {
        const caseType = document.getElementById('caseTypeColumnFilter').value;
        const reasonCode = document.getElementById('reasonCodeColumnFilter').value;
        const status = document.getElementById('statusColumnFilter').value;
        const date = document.getElementById('dateColumnFilter').value;

        return cases.filter(caseData => {
            const matchesCaseType = !caseType || caseData.caseType === caseType;
            const matchesReasonCode = !reasonCode || caseData.reasonCode === reasonCode;
            const matchesStatus = !status || caseData.status === status;
            const matchesDate = !date || caseData.createdDate === date;

            return matchesCaseType && matchesReasonCode && matchesStatus && matchesDate;
        });
    }

    // Filter column
    function filterColumn(column, value) {
        const filteredCases = getFilteredCases();
        updateTable(filteredCases);
    }

    // Update column filters
    function updateColumnFilters() {
        const filters = {
            caseType: new Set(),
            reasonCode: new Set(),
            status: new Set(),
            createdDate: new Set()
        };

        cases.forEach(caseData => {
            filters.caseType.add(caseData.caseType);
            filters.reasonCode.add(caseData.reasonCode);
            filters.status.add(caseData.status);
            filters.createdDate.add(caseData.createdDate);
        });

        Object.keys(filters).forEach(key => {
            const select = document.getElementById(`${key}ColumnFilter`);
            if (select) {
                const currentValue = select.value;
                select.innerHTML = '<option value="">All</option>' + 
                    Array.from(filters[key])
                        .sort()
                        .map(value => `<option value="${value}">${value}</option>`)
                        .join('');
                select.value = currentValue;
            }
        });
    }

    // Update table
    function updateTable(casesToDisplay = cases) {
        const tbody = document.querySelector('#caseTable tbody');
        tbody.innerHTML = '';
        
        casesToDisplay.forEach(caseData => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${caseData.caseId}</td>
                <td>${caseData.caseType}</td>
                <td>${caseData.reasonCode}</td>
                <td>${caseData.status}</td>
                <td>${caseData.createdDate}</td>
                <td>${caseData.aht}</td>
            `;
            tbody.appendChild(row);
        });
    }

    // Clear all data
    function clearData() {
        if (confirm('Are you sure you want to clear all data? This cannot be undone!')) {
            cases = [];
            localStorage.removeItem('cases');
            updateDashboard();
            alert('All data has been cleared!');
        }
    }

    // Export case history
    function exportCaseHistory() {
        const headers = ['Case ID', 'Case Type', 'Reason Code', 'Status', 'Created Date', 'AHT (min)'];
        const csvData = cases.map(caseData => [
            caseData.caseId,
            caseData.caseType,
            caseData.reasonCode,
            caseData.status,
            caseData.createdDate,
            caseData.aht
        ]);

        const csvContent = [
            headers.join(','),
            ...csvData.map(row => row.join(','))
        ].join('\n');

        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.setAttribute('hidden', '');
        a.setAttribute('href', url);
        a.setAttribute('download', 'case_history.csv');
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    // Update dashboard
    function updateDashboard() {
        updateTable(cases);
        updateColumnFilters();
        initializeCharts();
        updateMetrics();
        saveCases();
    }

    // Save to localStorage
    function saveCases() {
        localStorage.setItem('cases', JSON.stringify(cases));
    }

    // Load from localStorage
    function loadCases() {
        const savedCases = localStorage.getItem('cases');
        if (savedCases) {
            cases = JSON.parse(savedCases);
            updateDashboard();
        }
    }

// Refresh dashboard function
function refreshDashboard() {
    // Add rotation animation to refresh icon
    const refreshIcon = document.querySelector('.fa-sync-alt');
    refreshIcon.classList.add('rotating');
    
    // Reload data and update dashboard
    loadCases();
    updateDashboard();
    
    // Remove rotation class after animation
    setTimeout(() => {
        refreshIcon.classList.remove('rotating');
    }, 500);
}

// Update the loadCases function
function loadCases() {
    const savedCases = localStorage.getItem('cases');
    if (savedCases) {
        cases = JSON.parse(savedCases);
        updateDashboard();
    } else {
        cases = [];
        updateDashboard();
    }
}

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadCases();
    });
</script>
</body>
</html>
